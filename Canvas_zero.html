<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas_zero</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom animations if needed outside Tailwind */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        /* Hide scrollbar for cleaner look */
        textarea::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- 0. Icons (Replaced lucide-react for single file usage) ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                Plus: <path d="M5 12h14M12 5v14" />,
                X: <path d="M18 6 6 18M6 6l12 12" />,
                Command: <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z" />,
                Trash2: <><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>,
                Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
                Smartphone: <><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></>
            };

            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                >
                    {icons[name] || null}
                </svg>
            );
        };

        // --- 1. Utility & Constants ---

        const COLORS = [
            { bg: 'bg-white', border: 'border-gray-200', text: 'text-gray-900' },
            { bg: 'bg-yellow-50', border: 'border-yellow-200', text: 'text-yellow-900' },
            { bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-900' },
            { bg: 'bg-red-50', border: 'border-red-200', text: 'text-red-900' },
            { bg: 'bg-green-50', border: 'border-green-200', text: 'text-green-900' },
        ];

        const INITIAL_ITEMS = [
            { id: '1', type: 'text', x: 100, y: 100, content: '안녕하세요.\n여기는 생각이 머무는 곳입니다.', colorIdx: 0, z: 1 },
            { id: '2', type: 'text', x: 400, y: 200, content: '초등학생처럼 직관적으로,\n전문가처럼 깊이 있게.', colorIdx: 1, z: 2 },
            { id: '3', type: 'text', x: 150, y: 350, content: 'Tip: Ctrl+K를 눌러보세요.\n숨겨진 기능이 있습니다.', colorIdx: 2, z: 3 },
        ];

        // --- 2. Components ---

        // 미묘한 노이즈 텍스처 (아날로그 감성)
        const NoiseOverlay = () => (
            <div className="pointer-events-none fixed inset-0 z-50 opacity-[0.03] mix-blend-multiply"
                 style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")` }}>
            </div>
        );

        // 메인 앱
        function TimelessCanvas() {
            const [items, setItems] = useState(INITIAL_ITEMS);
            const [selectedId, setSelectedId] = useState(null);
            const [draggingId, setDraggingId] = useState(null);
            const [offset, setOffset] = useState({ x: 0, y: 0 });
            const [isCmdOpen, setIsCmdOpen] = useState(false);
            const [message, setMessage] = useState("준비됨");
            
            // --- Actions ---
            
            const showMessage = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(""), 2000);
            };

            const addItem = (type) => {
                const id = Date.now().toString();
                const newItem = {
                    id,
                    type,
                    x: Math.random() * 200 + 100,
                    y: Math.random() * 200 + 100,
                    content: '새로운 생각...',
                    colorIdx: 0,
                    z: Math.max(...items.map(i => i.z), 0) + 1
                };
                setItems(prev => [...prev, newItem]);
                setSelectedId(id);
                showMessage("새로운 조각 추가됨");
            };

            const updateItem = (id, updates) => {
                setItems(prev => prev.map(item => item.id === id ? { ...item, ...updates } : item));
            };

            const deleteItem = (id) => {
                setItems(prev => prev.filter(item => item.id !== id));
                setSelectedId(null);
                showMessage("조각이 삭제되었습니다");
            };

            const bringToFront = (id) => {
                const maxZ = Math.max(...items.map(i => i.z), 0);
                updateItem(id, { z: maxZ + 1 });
            };

            // --- Event Handlers (Drag & Drop) ---

            const handleMouseDown = (e, id) => {
                e.stopPropagation();
                setSelectedId(id);
                setDraggingId(id);
                bringToFront(id);
                
                const item = items.find(i => i.id === id);
                setOffset({
                    x: e.clientX - item.x,
                    y: e.clientY - item.y
                });
            };

            const handleMouseMove = useCallback((e) => {
                if (draggingId) {
                    const x = e.clientX - offset.x;
                    const y = e.clientY - offset.y;
                    updateItem(draggingId, { x, y });
                }
            }, [draggingId, offset]);

            const handleMouseUp = () => {
                setDraggingId(null);
            };

            // --- Shortcuts ---

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        setIsCmdOpen(prev => !prev);
                    }
                    if (e.key === 'Escape') {
                        setIsCmdOpen(false);
                        setSelectedId(null);
                    }
                    if (e.key === 'Backspace' && selectedId && !isCmdOpen) {
                        // 텍스트 편집 중이 아닐 때만 삭제
                        if (document.activeElement.tagName !== 'TEXTAREA') {
                            deleteItem(selectedId);
                        }
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('mousemove', handleMouseMove);
                window.addEventListener('mouseup', handleMouseUp);
                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                };
            }, [draggingId, offset, selectedId, isCmdOpen]);

            // --- Render ---

            return (
                <div className="relative w-full h-screen overflow-hidden bg-[#Fdfcfb] text-[#1a1a1a] font-sans selection:bg-black selection:text-white">
                    <NoiseOverlay />

                    {/* --- Background Grid (Subtle) --- */}
                    <div 
                        className="absolute inset-0 pointer-events-none opacity-[0.03]"
                        style={{ 
                            backgroundImage: 'linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)',
                            backgroundSize: '40px 40px'
                        }} 
                    />

                    {/* --- Canvas Area --- */}
                    <div className="absolute inset-0 z-10" onMouseDown={() => setSelectedId(null)}>
                        {items.map(item => (
                            <div
                                key={item.id}
                                onMouseDown={(e) => handleMouseDown(e, item.id)}
                                style={{
                                    left: item.x,
                                    top: item.y,
                                    zIndex: item.z,
                                    transform: `scale(${selectedId === item.id ? 1.02 : 1})`,
                                    transition: draggingId === item.id ? 'none' : 'transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s',
                                }}
                                className={`absolute p-6 w-64 min-h-[160px] rounded-sm shadow-sm cursor-grab active:cursor-grabbing group
                                    ${COLORS[item.colorIdx].bg} ${COLORS[item.colorIdx].text}
                                    ${selectedId === item.id ? 'shadow-xl ring-1 ring-black/5' : 'hover:shadow-md'}
                                `}
                            >
                                {/* Handle Bar */}
                                <div className="absolute top-0 left-0 right-0 h-6 flex justify-end px-2 items-center opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); deleteItem(item.id); }}
                                        className="p-1 hover:bg-black/5 rounded-full"
                                    >
                                        <Icon name="X" size={12} />
                                    </button>
                                </div>

                                {/* Content */}
                                <textarea
                                    value={item.content}
                                    onChange={(e) => updateItem(item.id, { content: e.target.value })}
                                    className={`w-full h-full bg-transparent resize-none outline-none font-medium leading-relaxed ${COLORS[item.colorIdx].text} placeholder:text-black/20`}
                                    placeholder="Type anything..."
                                    spellCheck={false}
                                    onMouseDown={(e) => e.stopPropagation()} 
                                />
                                
                                {/* Meta Info (Analog Feel) */}
                                <div className="absolute bottom-4 right-4 text-[10px] opacity-30 font-mono pointer-events-none select-none">
                                    NO. {item.id.slice(-4)}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* --- Bottom Status & Controls (The "Guide") --- */}
                    <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4">
                        {/* Toolbar */}
                        <div className="flex items-center gap-1 bg-white/80 backdrop-blur-md p-1.5 rounded-full border border-gray-200 shadow-lg shadow-gray-200/50 transition-all hover:scale-105 hover:shadow-xl">
                            <ToolButton icon={<Icon name="Plus" size={20} />} onClick={() => addItem('text')} label="추가" />
                            <div className="w-px h-4 bg-gray-200 mx-1" />
                            <ToolButton icon={<Icon name="Command" size={18} />} onClick={() => setIsCmdOpen(true)} label="명령" />
                        </div>
                    </div>

                    {/* Status Indicator (No Popups) */}
                    <div className="fixed bottom-8 right-8 z-40 text-xs font-mono text-gray-400 pointer-events-none mix-blend-multiply transition-opacity duration-300">
                        {message && <span className="animate-fade-in flex items-center gap-2"><span className="w-1.5 h-1.5 rounded-full bg-green-500 inline-block"/> {message}</span>}
                    </div>

                    {/* Intro/Help Text (Contextual) */}
                    <div className="fixed top-8 left-8 z-0 pointer-events-none">
                         <h1 className="text-2xl font-bold tracking-tight text-gray-900 opacity-10">CANVAS ZERO.</h1>
                    </div>

                    {/* --- Command Palette (Expert Hidden Feature) --- */}
                    {isCmdOpen && (
                        <div className="fixed inset-0 z-[100] bg-white/50 backdrop-blur-sm flex items-center justify-center" onClick={() => setIsCmdOpen(false)}>
                            <div 
                                className="bg-white w-[500px] rounded-xl shadow-2xl border border-gray-100 overflow-hidden animate-in fade-in zoom-in-95 duration-200"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <div className="p-4 border-b border-gray-100 flex items-center gap-3">
                                    <Icon name="Command" size={20} className="text-gray-400" />
                                    <input 
                                        autoFocus
                                        type="text" 
                                        placeholder="무엇을 할까요?" 
                                        className="w-full outline-none text-lg placeholder:text-gray-300"
                                    />
                                    <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500 font-mono">ESC</span>
                                </div>
                                <div className="p-2 max-h-[300px] overflow-y-auto">
                                    <div className="px-3 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Actions</div>
                                    <CmdItem icon={<Icon name="Zap" size={16}/>} label="모두 정렬하기 (Grid)" onClick={() => showMessage("자동 정렬 기능은 준비 중입니다")} shortcut="G" />
                                    <CmdItem icon={<Icon name="Trash2" size={16}/>} label="캔버스 비우기" onClick={() => { setItems([]); setIsCmdOpen(false); showMessage("캔버스가 초기화되었습니다"); }} />
                                    <div className="px-3 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 mt-3">Style</div>
                                    <CmdItem icon={<Icon name="Smartphone" size={16}/>} label="모바일 뷰 미리보기" onClick={() => showMessage("반응형 테스트 모드")} />
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- Sub Components ---

        function ToolButton({ icon, onClick, label }) {
            return (
                <button 
                    onClick={onClick}
                    className="p-3 rounded-full hover:bg-gray-100 text-gray-600 transition-colors relative group"
                >
                    {icon}
                    {/* Tooltip (Clean) */}
                    <span className="absolute -top-10 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                        {label}
                    </span>
                </button>
            );
        }

        function CmdItem({ icon, label, onClick, shortcut }) {
            return (
                <button 
                    onClick={onClick}
                    className="w-full flex items-center gap-3 px-3 py-3 hover:bg-gray-50 rounded-lg text-left group transition-colors"
                >
                    <div className="text-gray-400 group-hover:text-black transition-colors">{icon}</div>
                    <span className="flex-1 text-gray-700 group-hover:text-black">{label}</span>
                    {shortcut && <span className="text-xs text-gray-300 font-mono border border-gray-100 px-1.5 py-0.5 rounded">{shortcut}</span>}
                </button>
            );
        }

        // Start the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimelessCanvas />);
    </script>
</body>
</html>
